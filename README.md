brainfuck-jit
----------------------

This is brainfuck optimizing compiler and interpreter written in Rust.

Memory size is 30 000 cells. It is constant and does not increase dynamically.
Neither the negative memory cells are supported (memory does not extend to left).

First the source file is read and passed trough tokenizer which also removes comments,
then it is converted IR code that is optimized by the compiler. Lastly optimized IR code
is passed to custom simple x64 assembler which generates machine code at runtime
and then the compiled brainfuck program is executed.

Currently the JIT compilation is possible for following targets:
  - Windows x86-64
  - Linux x86-64

### Building

To build the project just run `cargo` command.

```
cargo build --release
```

### Running

The `bfjit` command accepts multiple flags which can be provided as command line arguments.

```
> bfjit.exe --help
bfjit v1.0

USAGE:
    bfjit.exe [FLAGS] <INPUT>

FLAGS:
    -h, --help           Prints help information
    -i, --interpreter    Forces interpreter mode
    -j, --jit            Forces JIT x64 compiler mode
    -u, --unoptimize     Disable brainfuck program optimization during IR stage
    -V, --version        Prints version information

ARGS:
    <INPUT>    Specified brainfuck source file to use

```

### Testing

To run provided test suite run `cargo` test command.

```
cargo test
```

### Optimizations

Compiler performs various optimizations during IR stage which result 
in faster runtime of brainfuck programs. The impact optimization has
on runtime is measured by running provided sample programs with different
settings.

### Performance

The following table was generated by `performance.py` script.

| file | interpreted time | jit unoptimized | jit optimized |
|------|------------------|-----------------|---------------|
|`hanoi.bf`|25916ms|6384ms|99ms|
|`hello_world.bf`|0ms|0ms|0ms|
|`long.bf`|28779ms|4435ms|574ms|
|`mandelbrot.bf`|39792ms|2771ms|908ms|
|`pi.bf`|11ms|1ms|0ms|
|`sierpinski.bf`|0ms|0ms|0ms|